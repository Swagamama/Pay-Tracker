<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay Tracker - Live Hourly Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Play, Pause, Coffee, DollarSign, Clock } = lucide;

        function HourlyPayCalculator() {
            const [hourlyRate, setHourlyRate] = useState('');
            const [isWorking, setIsWorking] = useState(false);
            const [onBreak, setOnBreak] = useState(false);
            const [currentPay, setCurrentPay] = useState(0);
            const [workStartTime, setWorkStartTime] = useState(null);
            const [totalWorkedSeconds, setTotalWorkedSeconds] = useState(0);
            const [breakStartTime, setBreakStartTime] = useState(null);
            const [breakTimeLeft, setBreakTimeLeft] = useState(0);
            
            const intervalRef = useRef(null);
            const breakTimeoutRef = useRef(null);
            const breakIntervalRef = useRef(null);

            // Keep screen awake while working
            useEffect(() => {
                let wakeLock = null;
                
                const requestWakeLock = async () => {
                    try {
                        if ('wakeLock' in navigator && isWorking) {
                            wakeLock = await navigator.wakeLock.request('screen');
                        }
                    } catch (err) {
                        console.log('Wake lock not supported');
                    }
                };

                if (isWorking) {
                    requestWakeLock();
                }

                return () => {
                    if (wakeLock) {
                        wakeLock.release();
                    }
                };
            }, [isWorking]);

            // Clear all timers on component unmount
            useEffect(() => {
                return () => {
                    if (intervalRef.current) clearInterval(intervalRef.current);
                    if (breakTimeoutRef.current) clearTimeout(breakTimeoutRef.current);
                    if (breakIntervalRef.current) clearInterval(breakIntervalRef.current);
                };
            }, []);

            // Main work timer
            useEffect(() => {
                if (isWorking && !onBreak && hourlyRate) {
                    intervalRef.current = setInterval(() => {
                        const now = Date.now();
                        const currentSessionSeconds = Math.floor((now - workStartTime) / 1000);
                        const totalSeconds = totalWorkedSeconds + currentSessionSeconds;
                        const hours = totalSeconds / 3600;
                        const pay = hours * parseFloat(hourlyRate);
                        setCurrentPay(pay);
                    }, 100); // Update every 100ms for smooth animation
                } else {
                    if (intervalRef.current) {
                        clearInterval(intervalRef.current);
                        intervalRef.current = null;
                    }
                }

                return () => {
                    if (intervalRef.current) clearInterval(intervalRef.current);
                };
            }, [isWorking, onBreak, hourlyRate, workStartTime, totalWorkedSeconds]);

            const startWork = () => {
                if (!hourlyRate || parseFloat(hourlyRate) <= 0) {
                    alert('Please enter a valid hourly rate');
                    return;
                }
                setIsWorking(true);
                setWorkStartTime(Date.now());
            };

            const pauseWork = () => {
                if (isWorking && workStartTime) {
                    const workedThisSession = Math.floor((Date.now() - workStartTime) / 1000);
                    setTotalWorkedSeconds(prev => prev + workedThisSession);
                }
                setIsWorking(false);
                setWorkStartTime(null);
            };

            const resetWork = () => {
                setIsWorking(false);
                setOnBreak(false);
                setCurrentPay(0);
                setWorkStartTime(null);
                setTotalWorkedSeconds(0);
                setBreakStartTime(null);
                setBreakTimeLeft(0);
                
                if (intervalRef.current) clearInterval(intervalRef.current);
                if (breakTimeoutRef.current) clearTimeout(breakTimeoutRef.current);
                if (breakIntervalRef.current) clearInterval(breakIntervalRef.current);
            };

            const startBreak = () => {
                if (!isWorking) return;
                
                // Save current work progress
                const workedThisSession = Math.floor((Date.now() - workStartTime) / 1000);
                setTotalWorkedSeconds(prev => prev + workedThisSession);
                
                setOnBreak(true);
                setBreakTimeLeft(30 * 60); // 30 minutes in seconds
                setBreakStartTime(Date.now());

                // Break countdown timer
                breakIntervalRef.current = setInterval(() => {
                    setBreakTimeLeft(prev => {
                        if (prev <= 1) {
                            clearInterval(breakIntervalRef.current);
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);

                // Auto-resume after 30 minutes
                breakTimeoutRef.current = setTimeout(() => {
                    setOnBreak(false);
                    setWorkStartTime(Date.now());
                    setBreakTimeLeft(0);
                    if (breakIntervalRef.current) clearInterval(breakIntervalRef.current);
                }, 30 * 60 * 1000);
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(amount);
            };

            const getTotalWorkedTime = () => {
                let total = totalWorkedSeconds;
                if (isWorking && workStartTime && !onBreak) {
                    total += Math.floor((Date.now() - workStartTime) / 1000);
                }
                return total;
            };

            return React.createElement('div', {
                className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4"
            }, 
                React.createElement('div', {
                    className: "max-w-md mx-auto"
                },
                    React.createElement('div', {
                        className: "bg-white rounded-3xl shadow-2xl p-8 space-y-6"
                    },
                        React.createElement('div', {
                            className: "text-center"
                        },
                            React.createElement(DollarSign, {
                                className: "w-16 h-16 text-green-500 mx-auto mb-4"
                            }),
                            React.createElement('h1', {
                                className: "text-3xl font-bold text-gray-800"
                            }, 'Pay Tracker'),
                            React.createElement('p', {
                                className: "text-gray-600"
                            }, 'Live hourly earnings calculator')
                        ),

                        !isWorking ? 
                            React.createElement('div', {
                                className: "space-y-4"
                            },
                                React.createElement('div', null,
                                    React.createElement('label', {
                                        className: "block text-sm font-medium text-gray-700 mb-2"
                                    }, 'Hourly Rate ($)'),
                                    React.createElement('input', {
                                        type: "number",
                                        step: "0.01",
                                        value: hourlyRate,
                                        onChange: (e) => setHourlyRate(e.target.value),
                                        placeholder: "Enter your hourly rate",
                                        className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none text-lg text-center"
                                    })
                                ),
                                React.createElement('button', {
                                    onClick: startWork,
                                    className: "w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl transition-colors flex items-center justify-center gap-2"
                                },
                                    React.createElement(Play, { className: "w-5 h-5" }),
                                    'Start Working'
                                )
                            )
                        :
                            React.createElement('div', {
                                className: "space-y-6"
                            },
                                React.createElement('div', {
                                    className: "text-center"
                                },
                                    React.createElement('div', {
                                        className: "text-6xl font-bold text-green-600 mb-2"
                                    }, formatCurrency(currentPay)),
                                    React.createElement('div', {
                                        className: "text-lg text-gray-600 flex items-center justify-center gap-2"
                                    },
                                        React.createElement(Clock, { className: "w-5 h-5" }),
                                        `${formatTime(getTotalWorkedTime())} worked`
                                    ),
                                    React.createElement('div', {
                                        className: "text-sm text-gray-500 mt-1"
                                    }, `$${hourlyRate}/hour`)
                                ),

                                onBreak && React.createElement('div', {
                                    className: "bg-orange-50 border-2 border-orange-200 rounded-xl p-4 text-center"
                                },
                                    React.createElement(Coffee, {
                                        className: "w-8 h-8 text-orange-500 mx-auto mb-2"
                                    }),
                                    React.createElement('div', {
                                        className: "text-lg font-semibold text-orange-700"
                                    }, 'Break Time'),
                                    React.createElement('div', {
                                        className: "text-2xl font-bold text-orange-600"
                                    }, formatTime(breakTimeLeft)),
                                    React.createElement('div', {
                                        className: "text-sm text-orange-600 mt-1"
                                    }, 'Auto-resume when break ends')
                                ),

                                React.createElement('div', {
                                    className: "grid grid-cols-2 gap-3"
                                },
                                    !onBreak && React.createElement('button', {
                                        onClick: startBreak,
                                        className: "bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2"
                                    },
                                        React.createElement(Coffee, { className: "w-4 h-4" }),
                                        '30min Break'
                                    ),
                                    React.createElement('button', {
                                        onClick: pauseWork,
                                        className: `bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 ${onBreak ? 'col-span-2' : ''}`
                                    },
                                        React.createElement(Pause, { className: "w-4 h-4" }),
                                        onBreak ? 'End Break & Pause' : 'Pause Work'
                                    )
                                ),

                                React.createElement('button', {
                                    onClick: resetWork,
                                    className: "w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition-colors"
                                }, 'Reset Session')
                            ),

                        React.createElement('div', {
                            className: "text-center text-xs text-gray-400 border-t pt-4"
                        }, 'Pay updates every 0.1 seconds while working')
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(HourlyPayCalculator), document.getElementById('root'));
    </script>
</body>
</html>

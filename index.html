<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pay Tracker Pro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root { --bg:#f9fafb; --card:#ffffff; --text:#1f2937; --muted:#6b7280; }
    body.dark { --bg:#111827; --card:#1f2937; --text:#f9fafb; --muted:#9ca3af; }
    body { background:var(--bg); font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
           margin:0; padding:1rem; min-height:100vh; color:var(--text); transition:background .3s,color .3s; }
    .container{max-width:32rem;margin:auto;}
    .card{background:var(--card);border-radius:1rem;box-shadow:0 8px 20px rgba(0,0,0,0.15);padding:1rem;margin-bottom:1rem;}
    .header{display:flex;justify-content:space-between;align-items:center;}
    .title{font-size:1.5rem;font-weight:700;}
    .toggle-dark{cursor:pointer;font-size:1.2rem;}
    .pay-display{text-align:center;}
    .pay-amount{font-size:2.2rem;font-weight:800;color:#059669;}
    .time-worked{margin-top:.5rem;font-size:1rem;color:var(--muted);}
    .btn{padding:.4rem .7rem;font-weight:600;border:none;border-radius:.6rem;cursor:pointer;margin:.2rem;font-size:.85rem;}
    .btn-green{background:#10b981;color:white;}
    .btn-blue{background:#3b82f6;color:white;}
    .btn-orange{background:#f97316;color:white;}
    .btn-gray{background:#6b7280;color:white;}
    .btn-red{background:#dc2626;color:white;}
    .footer{text-align:center;font-size:.8rem;color:var(--muted);}
    .history-list{font-size:.9rem;color:var(--text);}
    .history-item{display:flex;justify-content:space-between;align-items:center;padding:.3rem 0;border-bottom:1px solid #e5e7eb;}
    .hidden{display:none;}
    .break-display{text-align:center;font-weight:600;color:#f97316;margin-top:.5rem;}
    .history-controls button{margin-left:.3rem;}

    /* Totals layout */
    .totals-section {
      margin-bottom: 1.2rem;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 1rem;
    }
    .totals-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .totals-section h3 {
      margin: 0 0 .3rem 0;
      font-size: 1rem;
      color: var(--muted);
    }
    .total-amount {
      font-size: 1.4rem;
      font-weight: 700;
      color: #059669;
    }
    .total-sub {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 0.5rem;
    }
    .total-breakdown {
      font-size: 0.95rem;
      margin-top: 0.3rem;
    }
    .total-breakdown .muted {
      color: var(--muted);
      font-size: 0.85rem;
    }
    .tax-settings {
      margin-top: 1rem;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .tax-settings input { width: 60px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card header">
      <div class="title">Pay Tracker Pro</div>
      <div id="darkToggle" class="toggle-dark"><i class="fas fa-moon"></i></div>
    </div>

    <!-- Setup -->
    <div id="setupCard" class="card">
      <label>Hourly Rate ($)</label>
      <input id="hourlyRateInput" type="number" step="0.01" value="32"/>
      <button id="startWorkBtn" class="btn btn-green"><i class="fas fa-play"></i> Start Working</button>
    </div>

    <!-- Work Session -->
    <div id="workCard" class="card hidden">
      <div class="pay-display">
        <div id="payAmount" class="pay-amount">$0.00</div>
        <div id="timeWorked" class="time-worked">0h 0m</div>
        <div id="hourlyRateDisplay" class="hourly-rate">$32/hour</div>
      </div>
      <div>
        <button id="pauseBtn" class="btn btn-blue"><i class="fas fa-pause"></i> Pause</button>
        <select id="breakSelect">
          <option value="300">5 min</option>
          <option value="900">15 min</option>
          <option value="1800" selected>30 min</option>
          <option value="3600">1 hr</option>
        </select>
        <button id="breakBtn" class="btn btn-orange"><i class="fas fa-coffee"></i> Break</button>
        <button id="stopBtn" class="btn btn-red"><i class="fas fa-stop"></i> Stop Work</button>
        <button id="resetBtn" class="btn btn-gray"><i class="fas fa-undo"></i> Reset Session</button>
      </div>
      <div id="breakDisplay" class="break-display hidden"></div>
    </div>

    <!-- Totals -->
    <div class="card">
      <div class="totals-section">
        <h3>Today</h3>
        <div class="total-amount" id="dailyTotalAmount">$0.00</div>
        <div class="total-sub" id="dailyTotalHours">(0h 0m)</div>
        <button id="resetTodayBtn" class="btn btn-gray btn-small">Reset Today</button>
      </div>

      <div class="totals-section">
        <h3>This Week</h3>
        <div class="total-amount" id="weeklyGross">$0.00</div>
        <div class="total-sub" id="weeklyGrossHours">(0h 0m)</div>
        <div class="total-breakdown" id="weeklyAfterTax">
          After Tax: $0.00 <br>
          <span class="muted">(Tax: $0.00 @ 15%)</span>
        </div>
        <button id="resetWeekBtn" class="btn btn-gray btn-small">Reset Week</button>
      </div>

      <div class="tax-settings">
        <label for="taxRateInput">Tax Rate (%)</label>
        <input id="taxRateInput" type="number" step="0.1" value="15"/>
        <button id="saveTaxRateBtn" class="btn btn-gray btn-small">Save</button>
      </div>
    </div>

    <!-- History -->
    <div class="card">
      <strong>History</strong>
      <button id="exportBtn" class="btn btn-green btn-small"><i class="fas fa-file-export"></i> Export CSV</button>
      <div id="historyList" class="history-list"></div>
    </div>

    <div class="footer">Logs time, pay, breaks, tax & history — runs even after refresh</div>
  </div>

  <script>
    class PayTracker {
      constructor(){
        this.isWorking=false; this.isPaused=false; this.onBreak=false;
        this.hourlyRate=32; this.workStartTime=null; this.totalWorkedMs=0;
        this.breakEndTime=null;
        this.taxRate=parseFloat(localStorage.getItem('taxRate'))||15;
        this.logs=JSON.parse(localStorage.getItem('logs')||'[]');
        this.loadState(); this.startLoop(); this.updateHistory(); this.updateTotals();
      }
      saveState(){
        localStorage.setItem('trackerState',JSON.stringify({
          hourlyRate:this.hourlyRate,isWorking:this.isWorking,isPaused:this.isPaused,onBreak:this.onBreak,
          workStartTime:this.workStartTime,totalWorkedMs:this.totalWorkedMs,breakEndTime:this.breakEndTime
        }));
        localStorage.setItem('logs',JSON.stringify(this.logs));
        localStorage.setItem('taxRate',this.taxRate);
      }
      loadState(){
        const s=localStorage.getItem('trackerState');
        if(s) Object.assign(this,JSON.parse(s));
        if(this.isWorking){
          document.getElementById("setupCard").classList.add("hidden");
          document.getElementById("workCard").classList.remove("hidden");
          document.getElementById("hourlyRateDisplay").textContent=`$${this.hourlyRate}/hour`;
          if(this.onBreak && this.breakEndTime && Date.now()>=this.breakEndTime){ this.endBreak(); }
        }
      }
      formatTime(sec){const h=Math.floor(sec/3600),m=Math.floor((sec%3600)/60); return `${h}h ${m}m`; }
      formatHMS(sec){const m=Math.floor(sec/60),s=sec%60; return `${m}m ${s}s`; }
      calcPay(){let ms=this.totalWorkedMs; if(this.isWorking&&!this.isPaused&&!this.onBreak) ms+=Date.now()-this.workStartTime; return (ms/3600000)*this.hourlyRate;}
      calcSec(){let ms=this.totalWorkedMs; if(this.isWorking&&!this.isPaused&&!this.onBreak) ms+=Date.now()-this.workStartTime; return Math.floor(ms/1000);}
      updateDisplay(){
        document.getElementById('payAmount').textContent=this.calcPay().toLocaleString("en-US",{style:"currency",currency:"USD"});
        document.getElementById('timeWorked').textContent=this.formatTime(this.calcSec());
        document.getElementById('hourlyRateDisplay').textContent=`$${this.hourlyRate}/hour`;
        if(this.onBreak){
          const sec=Math.max(0,Math.floor((this.breakEndTime-Date.now())/1000));
          document.getElementById("breakDisplay").classList.remove("hidden");
          document.getElementById("breakDisplay").textContent=`On Break: ${this.formatHMS(sec)}`;
          if(sec<=0){ this.endBreak(); }
        } else { document.getElementById("breakDisplay").classList.add("hidden"); }
        this.saveState();
      }
      updateHistory(){
        const list=document.getElementById('historyList'); list.innerHTML="";
        this.logs.forEach((l,i)=>{
          const div=document.createElement('div'); div.className="history-item";
          div.innerHTML=`<span>${new Date(l.date).toLocaleString()} — ${this.formatTime(l.ms/1000)} — ${l.pay.toLocaleString("en-US",{style:"currency",currency:"USD"})}</span>`;
          const controls=document.createElement('span'); controls.className="history-controls";
          const del=document.createElement('button'); del.className="btn btn-red btn-small"; del.innerHTML='<i class="fas fa-trash"></i>';
          del.onclick=()=>{this.logs.splice(i,1);this.saveState();this.updateHistory();this.updateTotals();};
          const edit=document.createElement('button'); edit.className="btn btn-blue btn-small"; edit.innerHTML='<i class="fas fa-edit"></i>';
          edit.onclick=()=>{
            const newHours=parseFloat(prompt("Enter hours worked:",(l.ms/1000/3600).toFixed(2)));
            if(isNaN(newHours)) return;
            l.ms=newHours*3600000;
            l.pay=newHours*this.hourlyRate;
            this.saveState(); this.updateHistory(); this.updateTotals();
          };
          controls.appendChild(edit); controls.appendChild(del);
          div.appendChild(controls);
          list.appendChild(div);
        });
      }
      updateTotals(){
        const today=new Date().toDateString();
        const weekStart=new Date(); weekStart.setDate(weekStart.getDate()-weekStart.getDay());
        const d=this.logs.filter(l=>new Date(l.date).toDateString()==today);
        const w=this.logs.filter(l=>new Date(l.date)>=weekStart);
        const sum=(arr)=>arr.reduce((a,b)=>({pay:a.pay+b.pay,ms:a.ms+b.ms}),{pay:0,ms:0});
        const ds=sum(d), ws=sum(w);

        // Daily
        document.getElementById('dailyTotalAmount').textContent=ds.pay.toLocaleString("en-US",{style:"currency",currency:"USD"});
        document.getElementById('dailyTotalHours').textContent=`(${this.formatTime(ds.ms/1000)})`;

        // Weekly
        document.getElementById('weeklyGross').textContent=ws.pay.toLocaleString("en-US",{style:"currency",currency:"USD"});
        document.getElementById('weeklyGrossHours').textContent=`(${this.formatTime(ws.ms/1000)})`;

        const taxAmt=ws.pay*(this.taxRate/100), net=ws.pay-taxAmt;
        document.getElementById('weeklyAfterTax').innerHTML=
          `After Tax: ${net.toLocaleString("en-US",{style:"currency",currency:"USD"})}<br>
           <span class="muted">(Tax: ${taxAmt.toLocaleString("en-US",{style:"currency",currency:"USD"})} @ ${this.taxRate}%)</span>`;
      }
      setTaxRate(rate){this.taxRate=rate; this.saveState(); this.updateTotals();}
      startWork(rate){this.hourlyRate=rate; this.isWorking=true; this.isPaused=false; this.onBreak=false; this.workStartTime=Date.now(); this.totalWorkedMs=0; document.getElementById("setupCard").classList.add("hidden"); document.getElementById("workCard").classList.remove("hidden");}
      togglePause(){const btn=document.getElementById("pauseBtn"); if(!this.isWorking)return; if(!this.isPaused){this.totalWorkedMs+=Date.now()-this.workStartTime; this.isPaused=true; btn.innerHTML='<i class="fas fa-play"></i> Resume'; btn.classList.remove("btn-blue"); btn.classList.add("btn-green");} else{this.workStartTime=Date.now(); this.isPaused=false; btn.innerHTML='<i class="fas fa-pause"></i> Pause'; btn.classList.remove("btn-green"); btn.classList.add("btn-blue");}}
      startBreak(){if(!this.isWorking||this.onBreak)return; this.totalWorkedMs+=Date.now()-this.workStartTime; this.onBreak=true; const sec=parseInt(document.getElementById("breakSelect").value); this.breakEndTime=Date.now()+sec*1000;}
      endBreak(){this.onBreak=false; this.workStartTime=Date.now(); this.breakEndTime=null;}
      stopWork(){const pay=this.calcPay(); const sec=this.calcSec(); this.logs.push({date:new Date(),pay:pay,ms:sec*1000}); this.isWorking=false; this.isPaused=false; this.onBreak=false; this.totalWorkedMs=0; this.workStartTime=null; document.getElementById("setupCard").classList.remove("hidden"); document.getElementById("workCard").classList.add("hidden"); alert(`Shift Ended: ${this.formatTime(sec)}, ${pay.toLocaleString("en-US",{style:"currency",currency:"USD"})} earned.`); this.updateHistory(); this.updateTotals();}
      resetSession(){this.isWorking=false; this.isPaused=false; this.onBreak=false; this.totalWorkedMs=0; this.workStartTime=null; this.breakEndTime=null; document.getElementById("setupCard").classList.remove("hidden"); document.getElementById("workCard").classList.add("hidden");}
      resetToday(){const today=new Date().toDateString(); this.logs=this.logs.filter(l=>new Date(l.date).toDateString()!=today); this.updateHistory(); this.updateTotals(); this.saveState();}
      resetWeek(){const weekStart=new Date(); weekStart.setDate(weekStart.getDate()-weekStart.getDay()); this.logs=this.logs.filter(l=>new Date(l.date)<weekStart); this.updateHistory(); this.updateTotals(); this.saveState();}
      exportCSV(){let csv="Date,Hours Worked,Pay\n"; this.logs.forEach(l=>csv+=`${new Date(l.date).toLocaleString()},${(l.ms/1000/3600).toFixed(2)},${l.pay}\n`); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download="pay_log.csv"; a.click();}
      startLoop(){setInterval(()=>this.updateDisplay(),1000);}
    }
    const tracker=new PayTracker();
    document.getElementById("startWorkBtn").onclick=()=>{let r=parseFloat(document.getElementById("hourlyRateInput").value)||32; tracker.startWork(r);};
    document.getElementById("pauseBtn").onclick=()=>tracker.togglePause();
    document.getElementById("breakBtn").onclick=()=>tracker.startBreak();
    document.getElementById("stopBtn").onclick=()=>tracker.stopWork();
    document.getElementById("resetBtn").onclick=()=>tracker.resetSession();
    document.getElementById("resetTodayBtn").onclick=()=>tracker.resetToday();
    document.getElementById("resetWeekBtn").onclick=()=>tracker.resetWeek();
    document.getElementById("exportBtn").onclick=()=>tracker.exportCSV();
    document.getElementById("saveTaxRateBtn").onclick=()=>{const val=parseFloat(document.getElementById("taxRateInput").value)||15; tracker.setTaxRate(val);};
    document.getElementById("taxRateInput").value=tracker.taxRate;
    document.getElementById("darkToggle").onclick=()=>{document.body.classList.toggle("dark"); localStorage.setItem("darkMode",document.body.classList.contains("dark"));};
    if(localStorage.getItem("darkMode")==="true") document.body.classList.add("dark");
  </script>
</body>
</html>
